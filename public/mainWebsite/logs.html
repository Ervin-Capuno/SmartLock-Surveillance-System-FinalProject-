<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/mainWebsite/logs.css">
    <link rel="icon" type="image/x-icon" href="/mainWebsite/resources/favicon.ico">
    <title>Logs</title>
</head>
<body>
    <div id="navbar-container"></div>
    <div class="accordions-container">
        <div class="accordion accordion-flush" id="accordionFlushExample">
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                        Door Logs
                    </button>
                </h2>
                <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                    <div class="accordion-body" id="doorLogsAccordion">
                        <!-- Table for Door Logs -->
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Timestamp</th>
                                    <th scope="col">State</th>
                                </tr>
                            </thead>
                            <tbody id="doorLogsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                        Door Vibration
                    </button>
                </h2>
                <div id="flush-collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                    <div class="accordion-body" id="doorVibrationAccordion">
                        <!-- Table for Door Vibration Logs -->
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Timestamp</th>
                                    <th scope="col">State</th>
                                </tr>
                            </thead>
                            <tbody id="doorVibrationTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
                        Proximity
                    </button>
                </h2>
                <div id="flush-collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                    <div class="accordion-body" id="proximityAccordion">
                        <!-- Table for Proximity Logs -->
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Timestamp</th>
                                    <th scope="col">State</th>
                                </tr>
                            </thead>
                            <tbody id="proximityTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="navLoader.js"></script>
    <script src="logs.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
          // Fetch door logs from the API endpoint
          fetch('/api/all-door-states')
            .then(response => response.json())
            .then(data => {
              // Check if the response contains doorStates
              if (data.doorStates) {
                // Call a function to update the Door Logs accordion with the fetched data
                updateAccordion('doorLogsTableBody', data.doorStates);
              }
            })
            .catch(error => console.error('Error fetching door states:', error));
      
          // Function to update the accordion with the fetched door states
          function updateAccordion(tableBodyId, doorStates) {
            const tableBody = document.getElementById(tableBodyId);
      
            // Clear existing content in the table body
            tableBody.innerHTML = '';
      
            // Iterate through the door states and append rows to the table
            doorStates.forEach(doorState => {
              const row = document.createElement('tr');
              const timestampCell = document.createElement('td');
              const stateCell = document.createElement('td');
      
              // Format timestamp for readability
              const formattedTimestamp = new Date(doorState.doorTimestamp).toLocaleString();
      
              // Set the content of each cell
              timestampCell.textContent = formattedTimestamp;
              stateCell.textContent = doorState.doorState === 0 ? 'Close' : 'Open';
      
              // Append cells to the row
              row.appendChild(timestampCell);
              row.appendChild(stateCell);
      
              // Append the row to the table body
              tableBody.appendChild(row);
            });
          }
        });
      </script>   
</body>
</html>
